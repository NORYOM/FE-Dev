function Bezier(){var t=0,i=0;var s=false;var e;var _;var r=false;var h=false;var n=true;var o=false;var c;var l;this.setStart=function(s,e){t=s;i=e};this.getStart=function(){return{x:t,y:i}};this.setEnd=function(t,i){e=t;_=i};this.startBezier=function(t){o=t};this.setStartObj=function(t){c=t};this.setEndObj=function(t){l=t};this.getStartObj=function(){return c};this.getEndObj=function(){return l};this.isDrawing=function(){return r};this.setDrawing=function(t){r=t};this.isDrawn=function(){return s};this.setDrawn=function(t){s=t};this.onMouseDown=function(s){if(o){r=true;t=s.clientX-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);i=s.clientY-__cvsRect__.top*(__cvs__.height/__cvsRect__.height)}};this.onMouseDrag=function(t){if(r){s=true;e=t.clientX-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);_=t.clientY-__cvsRect__.top*(__cvs__.height/__cvsRect__.height)}};this.onMouseUp=function(t){r=false};this.onmousemove=function(t){};this.rend=function(){if(c){t=c.x;i=c.y}if(l){e=l.x;_=l.y}if(s){__ctx__.save();__ctx__.beginPath();__ctx__.moveTo(t,i);var r=t+(e-t)/4;var o=i-(_-i)/4;var a=e-(e-t)/4;var f=_+(_-i)/4;if(n){o=i;f=_}__ctx__.bezierCurveTo(r,o,a,f,e,_);__ctx__.lineWidth=1;__ctx__.strokeStyle="#222222";__ctx__.shadowColor="RGBA(50,50,50,1)";__ctx__.shadowOffsetX=2;__ctx__.shadowOffsetY=2;__ctx__.shadowBlur=10;__ctx__.stroke();__ctx__.closePath();if(h){__ctx__.fillStyle="#ff0000";__ctx__.fillRect(r,o,3,3);__ctx__.fillStyle="#00ff00";__ctx__.fillRect(a,f,3,3)}__ctx__.restore()}}}var bgCvs;function drawGrid(t){var i=20;if(!bgCvs){bgCvs=document.createElement("canvas")}bgCvs.style.position="absolute";bgCvs.width=t.width;bgCvs.height=t.height;bgCvs.style.left=t.style.left;bgCvs.style.top=t.style.top;bgCvs.style.zIndex=-100;document.body.appendChild(bgCvs);var s=bgCvs.getContext("2d");s.save();for(var e=0;e<bgCvs.width/i;e++){for(var _=0;_<bgCvs.height/i;_++){s.fillStyle="#999999";s.fillRect(e*(i+1),_*(i+1),i,i)}}s.restore()}function ButtonCyc(){Button.call(this);this.w=0;this.h=0;var t=5;var i=true;this.showBorder=function(t){i=!t};this.isInArea=function(i){var s=i.clientX;var e=i.clientY;var _=s-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var r=e-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(_>this.x-t&&_<this.x+this.w+t&&r>this.y-t&&r<this.y+this.h+t){return true}return false};this.getWidth=function(){return t*2};this.getHeight=function(){return t};this.rend=function(){var s=this.isMouseDown()?this.colorMouseDown:this.isMouseOver()?this.colorOn:this.colorOff;__ctx__.save();__ctx__.beginPath();__ctx__.arc(this.x+.4,this.y+.4,t,Math.PI/180*180,-1*(Math.PI/180)*180,false);if(!i){__ctx__.strokeStyle="#000000";__ctx__.lineWidth=1;__ctx__.stroke()}__ctx__.fillStyle=s;if(this.isDisabled()){__ctx__.fillStyle=this.colorDisable}__ctx__.fill();__ctx__.fillStyle="#222222";__ctx__.fillText(this.getText(),this.x-2,this.y+3);__ctx__.closePath();__ctx__.restore()}}function Button(){Object.call(this);this.colorOff="#cccccc";this.colorMouseDown="#dddddd";this.colorOn="#eeeeee";this.colorDisable="#666666";var t="";var i=false;var s=false;var e=false;this.getText=function(){return t};this.setText=function(i){t=i;this.getWidth()};this.isMouseDown=function(){return s};this.isMouseOver=function(){return i};this.setDisable=function(t){e=t};this.isDisabled=function(){return e};this.onMouseDown=function(t){if(e){return}if(this.isInArea(t)){s=true}};this.onMouseUp=function(t){if(this.isInArea(t)&&s&&i){this.onClick()}s=false};this.onMouseMove=function(t){if(e){return}if(this.isInArea(t)){i=true}else{i=false}};this.onClick=function(){}}function ButtonRec(){Button.call(this);this.w=0;this.h=8;var t=5;var i=false;this.showBorder=function(t){i=!t};this.getWidth=function(){var i=0;for(var s=0;s<this.getText().length;s++){var e=this.getText().charCodeAt(s);if(e>=0&&e<=128){i+=1}else{i+=2}}this.w=i*6;return this.w+t*2};this.getHeight=function(){return this.h+t*2};this.isInArea=function(i){var s=i.clientX;var e=i.clientY;var _=s-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var r=e-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(_>this.x-t&&_<this.x+this.w+t&&r>this.y-t&&r<this.y+this.h+t){return true}return false};this.rend=function(){var s=this.isMouseDown()?this.colorMouseDown:this.isMouseOver()?this.colorOn:this.colorOff;this.x=this.x+t;this.y=this.y+t;__ctx__.save();__ctx__.beginPath();__ctx__.arc(this.x,this.y,t,Math.PI/180*180,-1*(Math.PI/180)*90,false);__ctx__.lineTo(this.x+this.w,this.y-t);__ctx__.arc(this.x+this.w,this.y,t,-1*(Math.PI/180)*90,Math.PI/180*0,false);__ctx__.lineTo(this.x+this.w+t,this.y+this.h);__ctx__.arc(this.x+this.w,this.y+this.h,t,Math.PI/180*0,Math.PI/180*90,false);__ctx__.lineTo(this.x,this.y+this.h+t);__ctx__.arc(this.x,this.y+this.h,t,Math.PI/180*90,Math.PI/180*180,false);__ctx__.lineTo(this.x-t,this.y);if(!i){__ctx__.strokeStyle="#000000";__ctx__.lineWidth=1;__ctx__.stroke()}__ctx__.fillStyle=s;if(this.isDisabled()){__ctx__.fillStyle=this.colorDisable}__ctx__.fill();__ctx__.fillStyle="#222222";__ctx__.fillText(this.getText(),this.x,this.y+t*3/2);__ctx__.closePath();__ctx__.restore()}}function DigiNum(){Object.call(this);this.x=0;this.y=0;recLen=10;triH=2;triW=2;this.colorBorder="#444444";this.colorOff="#888888";this.colorOn="#ff9966";var t;this.setNum=function(i){t=i};this.test=function(){t="test"};this.shut=function(){t=null};this.getWidth=function(){return triW*4+recLen};this.getHeight=function(){return triH*6+recLen*2};this.drawHorizon=function(t,i,s){t=t+triW;i=i+triW;__ctx__.save();__ctx__.beginPath();__ctx__.moveTo(t,i);__ctx__.lineTo(t+triH,i-triW);__ctx__.lineTo(t+triH+recLen,i-triW);__ctx__.lineTo(t+triH+recLen+triW,i);__ctx__.lineTo(t+triH+recLen,i+triW);__ctx__.lineTo(t+triH,i+triW);__ctx__.lineTo(t,i);__ctx__.strokeStyle=this.colorBorder;__ctx__.lineWidth=1;__ctx__.stroke();__ctx__.fillStyle=s;__ctx__.fill();__ctx__.closePath();__ctx__.restore()};this.drawVertical=function(t,i,s){t=t+triW;i=i+triH;__ctx__.save();__ctx__.beginPath();__ctx__.moveTo(t,i);__ctx__.lineTo(t-triW,i+triH);__ctx__.lineTo(t-triW,i+triH+recLen);__ctx__.lineTo(t,i+triH+recLen+triH);__ctx__.lineTo(t+triW,i+triH+recLen);__ctx__.lineTo(t+triW,i+triH);__ctx__.lineTo(t,i);__ctx__.strokeStyle=this.colorBorder;__ctx__.lineWidth=1;__ctx__.stroke();__ctx__.fillStyle=s;__ctx__.fill();__ctx__.closePath();__ctx__.restore()};this.drawOff=function(){this.drawHorizon(this.x,this.y,this.colorOff);this.drawVertical(this.x,this.y,this.colorOff);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOff);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOff)};this.drawOn=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOn);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOn);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw0=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOn);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOn);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw1=function(){this.drawHorizon(this.x,this.y,this.colorOff);this.drawVertical(this.x,this.y,this.colorOff);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw2=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOff);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOn);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOff)};this.draw3=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOff);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw4=function(){this.drawHorizon(this.x,this.y,this.colorOff);this.drawVertical(this.x,this.y,this.colorOn);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw5=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOn);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOff);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw6=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOn);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOff);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOn);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw7=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOff);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOff);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.draw8=function(){this.drawOn()};this.draw9=function(){this.drawHorizon(this.x,this.y,this.colorOn);this.drawVertical(this.x,this.y,this.colorOn);this.drawHorizon(this.x,this.y+triH*2+recLen,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y,this.colorOn);this.drawVertical(this.x,this.y+triH*2+recLen,this.colorOff);this.drawHorizon(this.x,this.y+triH*4+recLen*2,this.colorOn);this.drawVertical(this.x+triH*2+recLen,this.y+triH*2+recLen,this.colorOn)};this.rend=function(){if(t==null){this.drawOff()}else if(t=="test"){this.drawOn()}else{switch(t){case 0:this.draw0();break;case 1:this.draw1();break;case 2:this.draw2();break;case 3:this.draw3();break;case 4:this.draw4();break;case 5:this.draw5();break;case 6:this.draw6();break;case 7:this.draw7();break;case 8:this.draw8();break;case 9:this.draw9();break}}}}function Label(){Object.call(this);this.h=8;this.text="";this.color="#000000";this.getWidth=function(){var t=0;for(var i=0;i<this.text.length;i++){var s=this.text.charCodeAt(i);if(s>=0&&s<=128){t+=1}else{t+=2}}this.w=t*6;return this.w};this.getHeight=function(){return this.h};this.onMouseMove=function(t){};this.rend=function(){__ctx__.save();__ctx__.fillStyle=this.color;__ctx__.fillText(this.text,this.x,this.y+this.h);__ctx__.restore()}}function Object(){this.id=(new Date).getTime()+Math.random();this.x=0;this.y=0;this.w=0;this.h=0;this.layer=0;this.onMouseDown=function(t){};this.onMouseUp=function(t){};this.onMouseDrag=function(t){};this.onMouseOver=function(t){};this.onMouseOut=function(t){};this.onMouseMove=function(t){};this.isInArea=function(t){};this.getWidth=function(){};this.getHeight=function(){};this.rend=function(){};this.passEvent=function(t){};this.isRemoved=function(){}}function PanelCyc(){Panel.call(this);this.w=100;this.h=150;this.r=this.getTitleH();this.rend=function(){__ctx__.save();__ctx__.strokeStyle="#000000";__ctx__.lineWidth=1;__ctx__.beginPath();__ctx__.fillStyle=this.getTitleColor();__ctx__.arc(this.x+this.r,this.y+this.r,this.r,Math.PI/180*180,-1*(Math.PI/180)*90,false);__ctx__.lineTo(this.x+this.w-this.r,this.y);__ctx__.arc(this.x+this.w-this.r,this.y+this.r,this.r,-1*(Math.PI/180)*90,Math.PI/180*0,false);__ctx__.lineTo(this.x,this.y+this.r);__ctx__.stroke();__ctx__.fill();__ctx__.fillStyle="#eeeebb";__ctx__.fillText(this.getTitle(),this.x+4+this.r/4,this.y+this.getTitleH()/2+4);__ctx__.closePath();__ctx__.beginPath();__ctx__.fillStyle="#eeee99";__ctx__.moveTo(this.x+this.w,this.y+this.getTitleH());__ctx__.lineTo(this.x+this.w,this.y+this.h);__ctx__.arc(this.x+this.w-this.r,this.y+this.h,this.r,Math.PI/180*0,Math.PI/180*90,false);__ctx__.lineTo(this.x+this.r,this.y+this.h+this.r);__ctx__.arc(this.x+this.r,this.y+this.h,this.r,Math.PI/180*90,Math.PI/180*180,false);__ctx__.lineTo(this.x,this.y+this.r);__ctx__.stroke();__ctx__.fill();__ctx__.closePath();__ctx__.restore();this.rendCloseButton(this.r/4);this.rendItems()}}function Panel(){Object.call(this);var t=false;var i;var s;var e=20;var _=[];var r=[];var h=[];var n=false;var o=false;var c=0;this.paramInOut={NON:0,IN:1,OUT:2};var l=new ButtonCyc;l.setText("x");l.onClick=function(){t=true};this.setTitle=function(t){i=t;var s=0;for(var e=0;e<t.length;e++){var _=t.charCodeAt(e);if(_>=0&&_<=128){s+=1}else{s+=2}}s=s*6;this.w=s>=this.w-20?s+20:this.w};this.getTitle=function(){return i};this.setTitleColor=function(t){s=t};this.getTitleColor=function(){return s};this.setTitleH=function(t){e=t};this.getTitleH=function(){return e};this.isMouseDownTitile=function(){return n};this.isRemoved=function(){return t};this.getParamIns=function(){return _};this.getParamOuts=function(){return r};this.getInParam=function(t){var i=0;for(var s=0;s<_.length;s++){if(_[s]){if(i==t){return _[s]}i++}}return null};this.getOutParam=function(t){var i=0;for(var s=0;s<r.length;s++){if(r[s]){if(i==t){return r[s]}i++}}return null};this.getItems=function(){return h};this.doSomethingInLoop=function(){};var a,f;this.onMouseDown=function(t){if(this.isInTitle(t)){n=true;a=t.clientX-this.x;f=t.clientY-this.y}if(this.isInPanel(t)){o=true}c=this.layer;this.layer=1e3;l.onMouseDown(t)};this.onMouseUp=function(t){n=false;o=false;this.layer=c;c=0;l.onMouseUp(t)};this.onMouseMove=function(t){if(n){this.x=t.clientX-a;this.y=t.clientY-f}l.onMouseMove(t)};this.passEvent=function(t){for(var i=0;i<h.length;i++){if(h[i].constructor.name.substring(0,8)=="Selector"){if(t.type=="mousedown"){h[i].onMouseDown(t)}else if(t.type=="mousemove"){h[i].onMouseMove(t)}}}};this.addItem=function(t,i){if(t==this.paramInOut.IN){_.push(new PointIn);r.push(null)}else if(t==this.paramInOut.OUT){_.push(null);r.push(new PointOut)}else{_.push(null);r.push(null)}h.push(i);var s=5;for(var e=0;e<h.length;e++){s+=h[e].getHeight()+2}this.w=i.getWidth()>=this.w-20?i.getWidth()+20:this.w;this.h=this.getTitleH()+s};this.removeItem=function(t){};this.isInTitle=function(t){var i=t.clientX;var s=t.clientY;var e=i-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var _=s-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(e>this.x&&e<this.x+this.w&&_>this.y&&_<this.y+this.getTitleH()){return true}return false};this.isInPanel=function(t){var i=t.clientX;var s=t.clientY;var e=i-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var _=s-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(e>this.x&&e<this.x+this.w&&_>this.y+this.getTitleH()&&_<this.y+this.getTitleH()+this.h){return true}return false};this.isInArea=function(t){var i=t.clientX;var s=t.clientY;var e=i-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var _=s-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(e>this.x&&e<this.x+this.w&&_>this.y&&_<this.y+this.getTitleH()+this.h){return true}return false};this.rendCloseButton=function(t){l.x=this.x+this.w-l.getWidth()-t;l.y=this.y+this.getTitleH()/2;l.rend()};this.rendItems=function(){var t=this.getItems();var i=this.getParamIns();var s=this.getParamOuts();var e=5;for(var _=0;_<t.length;_++){if(i[_]){t[_].x=this.x+i[_].r*2;t[_].y=this.y+this.getTitleH()+e+i[_].r;i[_].x=this.x;i[_].y=t[_].y+t[_].getHeight()/2-i[_].r/2+2;i[_].rend()}if(s[_]){t[_].x=this.x+this.w-t[_].getWidth()-s[_].r*2;t[_].y=this.y+this.getTitleH()+e+s[_].r;s[_].x=this.x+this.w;s[_].y=t[_].y+t[_].getHeight()/2-s[_].r/2+2;s[_].rend()}if(!i[_]&&!s[_]){t[_].x=this.x+this.w/2-t[_].getWidth()/2;t[_].y=this.y+this.getTitleH()+e+5}e+=t[_].getHeight()+5;t[_].rend()}this.doSomethingInLoop()}}function PanelRec(){Panel.call(this);this.w=100;this.h=150;this.rend=function(){__ctx__.save();__ctx__.strokeStyle="#000000";__ctx__.lineWidth=1;__ctx__.beginPath();__ctx__.fillStyle=this.getTitleColor();__ctx__.moveTo(this.x,this.y);__ctx__.lineTo(this.x+this.w,this.y);__ctx__.lineTo(this.x+this.w,this.y+this.getTitleH());__ctx__.lineTo(this.x,this.y+this.getTitleH());__ctx__.lineTo(this.x,this.y);__ctx__.stroke();__ctx__.fill();__ctx__.fillStyle="#eeeebb";__ctx__.fillText(this.getTitle(),this.x+4,this.y+this.getTitleH()/2+2);__ctx__.closePath();__ctx__.beginPath();__ctx__.fillStyle="#eeee99";__ctx__.moveTo(this.x+this.w,this.y+this.getTitleH());__ctx__.lineTo(this.x+this.w,this.y+this.getTitleH()+this.h);__ctx__.lineTo(this.x,this.y+this.getTitleH()+this.h);__ctx__.lineTo(this.x,this.y+this.getTitleH());__ctx__.stroke();__ctx__.fill();__ctx__.closePath();__ctx__.restore();this.rendCloseButton(0);this.rendItems()}}function PointIn(){Point.call(this);var t="#cc7777";var i;this.setLink=function(t){i=t};this.getLink=function(){return i};this.rend=function(){var s=this.mouseDrag?i?t:this.readyForLink?this.colorReday:this.colorOff:i?this.colorOn:this.colorOff;__ctx__.save();__ctx__.beginPath();__ctx__.arc(this.x,this.y,this.r,Math.PI/180*0,Math.PI/180*360,false);__ctx__.strokeStyle="#000000";__ctx__.lineWidth=2;__ctx__.stroke();__ctx__.fillStyle=s;__ctx__.fill();__ctx__.fillStyle="#222222";__ctx__.fillText(this.text,this.x-this.w,this.y);__ctx__.closePath();__ctx__.restore()}}function Point(){Object.call(this);this.r=5;this.text="";this.value=null;this.colorOff="#cccccc";this.colorReday="#77cc77";this.colorMouseDown="#7777cc";this.colorOn="#cccc00";this.mouseDrag=false;this.mouseDown=false;this.readyForLink=false;this.holdForLink=function(){readyForLink=false};this.readyForLink=function(){readyForLink=true};this.isInArea=function(t){var i=t.clientX;var s=t.clientY;var e=i-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var _=s-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(e>this.x-this.r&&e<this.x+this.r&&_>this.y-this.r&&_<this.y+this.r){return true}return false};this.onMouseDown=function(t){if(this.isInArea(t)){this.mouseDown=true}};this.onMouseDrag=function(t){if(this.isInArea(t)){this.mouseDrag=true}else{this.mouseDrag=false}};this.onMouseUp=function(t){this.mouseDown=false;if(this.isInArea(t)){this.mouseDrag=false}}}function PointOut(){Point.call(this);var t=0;this.addLink=function(){t++};this.removeLink=function(){t--;if(t<0){t=0}};this.isOutStart=function(){return this.mouseDown};this.rend=function(){var i=this.mouseDrag?this.readyForLink?this.colorMouseDown:this.colorOff:t?this.colorOn:this.colorOff;i=this.mouseDown?this.colorMouseDown:i;__ctx__.save();__ctx__.beginPath();__ctx__.arc(this.x,this.y,this.r,Math.PI/180*0,Math.PI/180*360,false);__ctx__.strokeStyle="#000000";__ctx__.lineWidth=2;__ctx__.stroke();__ctx__.fillStyle=i;__ctx__.fill();__ctx__.fillStyle="#222222";__ctx__.fillText(this.text,this.x-this.w,this.y);__ctx__.closePath();__ctx__.restore()}}var __cvs__;var __cvsRect__;var __ctx__;function Render(t,i,s){var e=i;var _=s;var r=60;__cvs__=document.getElementById(t);__cvs__.width=i;__cvs__.height=s;if(!__cvs__||!__cvs__.getContext){alert("not support canvas");return}if(!__ctx__){__ctx__=__cvs__.getContext("2d")}var h=[];var n=[];var o=0;var c=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){setInterval(t,1e3/r)}}();__cvsRect__=__cvs__.getBoundingClientRect();window.onresize=function(){__cvsRect__=__cvs__.getBoundingClientRect()};window.onscroll=function(){__cvsRect__=__cvs__.getBoundingClientRect()};this.addElement=function(t){if(t.constructor.name.substring(0,5)!="Panel"){console.log("Currently not support adding items directly in canvas, please add item in Panel.");return}h.push(t);t.layer=o++;t.ctx=__ctx__};function l(t){for(var i=0;i<h.length;i++){if(t&&t.id==h[i].id){h.splice(i,1);break}}var s=t.getParamIns();var e=t.getParamOuts();for(var _=0;_<s.length;_++){if(s[_]){f=s[_].getLink();if(f){s[_].setLink(null);s[_].value=null;f.getStartObj().removeLink();f.setStartObj(null);f.setEndObj(null);u(f);f=null;break}}}for(var _=0;_<e.length;_++){if(e[_]){for(var i=0;i<n.length;i++){if(e[_]==n[i].getStartObj()){f=n[i];if(f){f.getStartObj().removeLink();f.getStartObj().value=null;f.getEndObj().setLink(null);f.getEndObj().value=null;f.setStartObj(null);f.setEndObj(null);u(f);f=null;i--}}}}}t=null}this.setFPS=function(t){r=t};this.getCTX=function(){return __ctx__};function a(){var t;for(var i=0;i<h.length;i++){for(var s=i;s<h.length-1;s++){if(h[i].layer>h[s+1].layer){t=h[i];h[i]=h[s+1];h[s+1]=t}}}}var f;this.rend=function(){var t=false;__cvs__.onmousedown=function(i){t=true;var s=-1;for(var e=h.length-1;e>=0;e--){if(h[e].isInArea(i)){s=e;break}var _=h[e].getParamIns();for(var r=0;r<_.length;r++){if(_[r]&&_[r].isInArea(i)){s=e;break}}if(s!=-1){break}var n=h[e].getParamOuts();for(var r=0;r<n.length;r++){if(n[r]&&n[r].isInArea(i)){s=e;break}}}if(s!=-1){h[s].onMouseDown(i);var o=h[s].getItems();var c=h[s].getParamIns();var l=h[s].getParamOuts();for(var r=0;r<o.length;r++){if(l[r]&&l[r].isInArea(i)){l[r].onMouseDown(i);f=new Bezier;l[r].addLink();f.setStartObj(l[r]);f.startBezier(true);f.onMouseDown(i)}if(c[r]&&c[r].isInArea(i)){c[r].onMouseDown(i);f=c[r].getLink();if(f){c[r].setLink(null);f.getEndObj().value=null;f.setEndObj(null);u(f)}}if(o[r].constructor.name.substring(0,8)!="Selector"){o[r].onMouseDown(i)}}}for(var e=h.length-1;e>=0;e--){h[e].passEvent(i)}a()};__cvs__.onmouseup=function(i){for(var s=0;s<h.length;s++){h[s].onMouseUp(i);if(h[s].constructor.name.substring(0,5)=="Panel"){var e=h[s].getItems();var _=h[s].getParamIns();var r=h[s].getParamOuts();for(var o=0;o<e.length;o++){if(r[o]){r[o].onMouseUp(i)}if(_[o]){_[o].onMouseUp(i);_[o].holdForLink();if(_[o].isInArea(i)){if(f){if(!_[o].getLink()){f.setEndObj(_[o]);_[o].setLink(f)}else{console.log("already occupied!")}}}}e[o].onMouseUp(i)}}}t=false;if(f){if(!f.getEndObj()){f.getStartObj().removeLink();f.setStartObj(null);f=null}else{var c=false;for(var s=0;s<n.length;s++){if(f==n[s]){c=true;f=null;break}}if(!c){n.push(f);f=null}}}};__cvs__.onmousemove=function(i){for(var s=h.length-1;s>=0;s--){h[s].onMouseMove(i);if(h[s].constructor.name.substring(0,5)=="Panel"){var e=h[s].getItems();var _=h[s].getParamIns();var r=h[s].getParamOuts();for(var n=0;n<e.length;n++){if(r[n]){r[n].onMouseMove(i);if(t){r[n].onMouseDrag(i)}}if(_[n]){_[n].onMouseMove(i);if(t){_[n].onMouseDrag(i)}}e[n].onMouseMove(i);if(t){e[n].onMouseDrag(i)}}}if(t){h[s].onMouseDrag(i)}}if(f){f.onMouseDrag(i)}};drawGrid(__cvs__);c(v)};function u(t){for(var i=0;i<n.length;i++){if(t&&t==n[i]){var s=n[i].getEndObj();if(s){s.value=null}n.splice(i,1);break}}}function x(){__ctx__.clearRect(0,0,e,_);__ctx__.fillStyle="rgba(125,125,125,0)";__ctx__.fillRect(0,0,e,_)}function v(){x();for(var t=0;t<n.length;t++){n[t].rend();var i=n[t].getStartObj();var s=n[t].getEndObj();if(i&&s){s.value=i.value}}if(f){f.rend();var i=f.getStartObj();var s=f.getEndObj();if(i&&s){s.value=i.value}}for(var t=0;t<h.length;t++){h[t].rend();if(h[t].isRemoved()){l(h[t])}}c(v)}}function Selector(){Object.call(this);this.colorSelBg="#727272";this.colorSelOn="#3C3F41";this.colorSelDisable="#666666";var t=50;var i=10;var s=5;var e=false;var _=[{value:257,display:"Please select"}];var r=0;var h=false;var n=10;var o=10;var c,l,a,f;var u=false;var x=r;var v;this.setPos=function(t,i){this.x=t;this.y=i};this.getWidth=function(){return t+s*3/2};this.getHeight=function(){return n+s*2};this.setDisable=function(t){e=t};this.setOption=function(t){_=t};this.addOption=function(e,r){_.push({value:e,display:r});o=s*3.5*_.length;i=s*3.5*_.length;for(var h=0;h<_.length;h++){var n=d(_[h].display);if(n>t-s){t=n+s*2}}};this.clearOption=function(t){_=[]};this.setDefaultOption=function(t){if(t>_.length){t=_.length-1}if(t<0){t=0}r=t};this.getValue=function(){return _[r].value};this.setEvtName=function(t){v=new CustomEvent(t)};this.onMouseDown=function(t){if(this.isInSelectorArea(t.clientX,t.clientY)&&_.length>1){h=!h}if(!h){u=false;if(x!=r){x=r;dispatchEvent(v)}}else{x=r}};this.onMouseMove=function(t){if(!h){return}var i=t.clientY-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);if(i>this.y+s+n){u=true}if(h&&u){this.highLight(t.clientX,t.clientY)}};this.isInSelectorArea=function(e,_){var r=e-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var h=_-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);return r>this.x-s&&r<this.x+t+s&&h>this.y-s&&h<this.y+i+s};this.highLight=function(i,e){var h=i-__cvsRect__.left*(__cvs__.width/__cvsRect__.width);var n=e-__cvsRect__.top*(__cvs__.height/__cvsRect__.height);c=this.x-s;a=t+s*2;f=s*3.5;for(var o=0;o<_.length;o++){l=this.y-s+o*s*3.5;if(h>c&&h<c+a&&n>l&&n<l+f){r=o}}};function d(t){var i=0;for(var s=0;s<t.length;s++){charCode=t.charCodeAt(s);if(charCode>=0&&charCode<=128)i+=1;else i+=2}return i*6}function y(i,e){__ctx__.beginPath();__ctx__.strokeStyle="#eeee99";__ctx__.moveTo(i+t-s,e+s/2);__ctx__.lineTo(i+t,e+s/2);__ctx__.lineTo(i+t-s/2,e+s*3/2);__ctx__.lineTo(i+t-s,e+s/2);__ctx__.stroke();__ctx__.closePath()}this.rend=function(){this.x=this.x+s;this.y=this.y+s;__ctx__.save();if(!h){i=n;this.setDefaultOption(r);__ctx__.beginPath();__ctx__.arc(this.x,this.y,s,Math.PI/180*180,-1*(Math.PI/180)*90,false);__ctx__.lineTo(this.x+t,this.y-s);__ctx__.arc(this.x+t,this.y,s,-1*(Math.PI/180)*90,Math.PI/180*0,false);__ctx__.lineTo(this.x+t+s,this.y+i);__ctx__.arc(this.x+t,this.y+i,s,Math.PI/180*0,Math.PI/180*90,false);__ctx__.lineTo(this.x,this.y+i+s);__ctx__.arc(this.x,this.y+i,s,Math.PI/180*90,Math.PI/180*180,false);__ctx__.lineTo(this.x-s,this.y);__ctx__.strokeStyle="#000000";__ctx__.lineWidth=1;__ctx__.stroke();__ctx__.fillStyle=this.colorSelOn;if(e){__ctx__.fillStyle=this.colorSelDisable}__ctx__.fill();__ctx__.fillStyle="#eeee99";__ctx__.fillText(_[r].display,this.x,this.y+s*3/2);__ctx__.closePath();y(this.x,this.y)}else{i=o;__ctx__.beginPath();__ctx__.moveTo(this.x-s,this.y-s);__ctx__.lineTo(this.x+t+s,this.y-s);__ctx__.lineTo(this.x+t+s,this.y+i);__ctx__.lineTo(this.x-s,this.y+i);__ctx__.lineTo(this.x-s,this.y-s);__ctx__.strokeStyle="#000000";__ctx__.lineWidth=1;__ctx__.stroke();__ctx__.fillStyle=this.colorSelBg;if(e){__ctx__.fillStyle=this.colorSelDisable}__ctx__.fill();for(var u=0;u<_.length;u++){if(_[r].value==_[u].value){var x=this.x-s;var v=this.y-s+u*s*3.5;c=x;l=v;a=t+s*2;f=s*3.5;__ctx__.beginPath();__ctx__.fillStyle=this.colorSelOn;__ctx__.moveTo(x,v);__ctx__.lineTo(x+t+s*2,v);__ctx__.lineTo(x+t+s*2,v+s*3.5);__ctx__.lineTo(x,v+s*3.5);__ctx__.lineTo(x,v);__ctx__.fill();__ctx__.closePath()}__ctx__.fillStyle="#eeee99";__ctx__.fillText(_[u].display,this.x,this.y+s*1.5+u*s*3.5)}__ctx__.closePath();y(this.x,this.y)}__ctx__.restore()}}